<html>
<head>
<style>
#button{
  position:absolute;
  top:5%;
  width:100%;
  text-align:center;
}
</style>
</head>
<body>
<div id="button">
  <button id="move">
    move
  </button>
  <br>
  <button id="view">
    change view angle
  </button>
</div>


<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://jyunming-chen.github.io/tutsplus/js/KeyboardState.js"></script>
<script type="module">
import * as THREE from 'https://cdn.skypack.dev/three@0.136';
import { OrbitControls } from 'https://cdn.skypack.dev/three@0.136/examples/jsm/controls/OrbitControls.js';
    
var camera, scene, renderer;
var controls;
var angle = 0;
var train;
var movebt = false,
  viewbt = false;

init();
animate();

function init() {
  let width = window.innerWidth;
  let height = window.innerHeight;


  renderer = new THREE.WebGLRenderer();
  renderer.setSize(width, height);
  renderer.setClearColor('grey');
  document.body.appendChild(renderer.domElement);

  scene = new THREE.Scene();

  camera = new THREE.PerspectiveCamera(60, width / height, 1, 1000);
  camera.position.set(100, 20, 0);

  controls = new OrbitControls(camera, renderer.domElement);

  let grid = new THREE.GridHelper(200, 20, 'red', 'white');
  scene.add(grid);

  let axes = new THREE.AxesHelper(10);
  scene.add(axes);

  train = new model();
  let face = new makeface();
  train.add(face);
  scene.add(train);
}


function model() {
  var mt = new THREE.MeshNormalMaterial();
  var cube = new THREE.Mesh(new THREE.BoxGeometry(30, 5, 20), mt);
  cube.position.y = 7;
  var cylinder = new THREE.Mesh(new THREE.CylinderGeometry(10, 10, 5, 16), mt);
  cylinder.rotation.z = -Math.PI / 2;
  cylinder.position.set(10, 10, 0);
  var cylinder1 = new THREE.Mesh(new THREE.CylinderGeometry(4, 4, 17, 12), mt);
  cylinder1.rotation.x = Math.PI / 2;
  cylinder1.position.y = -3;
  var cylinder2 = new THREE.Mesh(new THREE.CylinderGeometry(4, 4, 17, 12), mt);
  cylinder2.rotation.x = Math.PI / 2;
  cylinder2.position.set(9, -3, 0);
  var cylinder3 = new THREE.Mesh(new THREE.CylinderGeometry(4, 4, 17, 12), mt);
  cylinder3.rotation.x = Math.PI / 2;
  cylinder3.position.set(-9, -3, 0);
  var cube1 = new THREE.Mesh(new THREE.BoxGeometry(10, 10, 10), mt);
  cube1.position.set(5, 5, 0);
  var cube2 = new THREE.Mesh(new THREE.BoxGeometry(15, 15, 15), mt);
  cube2.position.set(-5, 8, 0);
  var cylinder4 = new THREE.Mesh(new THREE.CylinderGeometry(2, 2, 10, 12), mt);
  cylinder4.position.set(10, 23, 0);

  cube.add(cylinder, cylinder1, cylinder2, cylinder3, cube1, cube2, cylinder4);
  cube.position.set(50, 7, 0);
  cube.rotation.y = Math.PI / 2 - angle;

  return cube;
}


function makeface() {
  let vertices = [];
  let indices = [];

  vertices.push(
    new THREE.Vector3(0, 10, 10),
    new THREE.Vector3(0, 10, 5),
    new THREE.Vector3(0, 5, 5),
    new THREE.Vector3(0, 5, 10),
    new THREE.Vector3(0, 17, 14),
    new THREE.Vector3(0, 16, 9),
    new THREE.Vector3(0, 15, 9),
    new THREE.Vector3(0, 17, 1.5),
    new THREE.Vector3(0, 16, 6.5),
    new THREE.Vector3(0, 15, 6.5),
    new THREE.Vector3(0, 15, 12),
    new THREE.Vector3(0, 13, 14),
    new THREE.Vector3(0, 13, 10),
    new THREE.Vector3(0, 11, 12),
    new THREE.Vector3(0, 15, 3.5),
    new THREE.Vector3(0, 13, 1.5),
    new THREE.Vector3(0, 13, 5.5),
    new THREE.Vector3(0, 11, 3.5),
  );

  var geometry = new THREE.BufferGeometry().setFromPoints(vertices);

  indices.push(
    2, 1, 0,
    3, 2, 0,
    4, 6, 5,
    7, 8, 9,
    10, 11, 12,
    11, 13, 12,
    16, 15, 14,
    16, 17, 15
  );
  geometry.setIndex(indices);

  geometry.computeBoundingSphere();
  geometry.computeVertexNormals();

  let mesh = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({
    color: 0x000000
  }));

  let face = new THREE.Object3D();
  face.add(mesh);
  face.position.set(13, 0, -7.5);
  return face;
}


$("#move").click(function() {
  movebt = !movebt;
});


$("#view").click(function() {
  viewbt = !viewbt;
  if(viewbt == true){
	controls.enableRotate = false;
	controls.enablePan = false;
	controls.enableZoom = false;
  }
  else{
	controls.enableRotate = true;
	controls.enablePan = true;
	controls.enableZoom = true;
  }
});


function animate() {

  if (movebt) {
    angle -= 0.01;
    train.position.set(50 * Math.cos(angle), 7, 50 * Math.sin(angle));
    train.rotation.y = Math.PI / 2 - angle;
  }

  if (viewbt)
    train.add(camera);

  else
    train.remove(camera);


  renderer.render(scene, camera);
  requestAnimationFrame(animate);


}

</script>
</body>
</html>